{% extends 'erp/base.html' %}


{% block title %}Settings - LiteWork{% endblock %}
{% block page_title %}Settings{% endblock %}

{% block content %}
<div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md h-full flex flex-col">
    <div class="flex border-b border-gray-200 dark:border-gray-700 text-lg mb-6">
        <span class="font-semibold bg-blue-600 dark:bg-blue-700 text-white px-4 py-2 rounded-t-lg tab-active">Account & Security</span>
        <span class="text-gray-700 dark:text-gray-300 px-4 py-2 cursor-pointer tab-button hover:bg-gray-100 dark:hover:bg-gray-700" data-tab="shipping">Shipping</span>
        <span class="text-gray-700 dark:text-gray-300 px-4 py-2 cursor-pointer tab-button hover:bg-gray-100 dark:hover:bg-gray-700" data-tab="notification">Notification</span>
    </div>

    <div id="account-tab" class="tab-content">
        <div class="bg-gray-800 p-6 rounded-xl shadow-lg mb-6" style="background-color: #1F2937 !important;">
            <h2 class="text-xl font-bold mb-4" style="color: white !important;">Account Information</h2>

            <div class="flex justify-between items-center account-info-line">
                <span class="font-medium w-1/3" style="color: white !important;">Username</span>
                <span class="text-lg w-1/3 text-left" style="color: white !important;">{{ user.get_full_name|default:user.username }}</span>
                <div class="relative w-1/3 text-right">
                    <button onclick="toggleEditForm('username-form')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded-md text-sm flex items-center justify-end ml-auto" style="color: white !important;">
                        Edit <i class="fas fa-caret-down ml-2"></i>
                    </button>
                    <div id="username-form" class="hidden mt-2 bg-white dark:bg-gray-800 p-3 rounded-md shadow-lg absolute right-0 z-10 w-64">
                        <form method="post" action="{% url 'erp:update_profile' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="username">
                            <input type="text" name="full_name" placeholder="Full Name" class="w-full mb-2 p-2 text-gray-800 bg-gray-100 dark:bg-gray-700 dark:text-white rounded">
                            <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded w-full hover:bg-green-700">Save</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center account-info-line">
                <span class="font-medium w-1/3" style="color: white !important;">Email</span>
                <span class="text-lg w-1/3 text-left" style="color: white !important;">{{ user.email }}</span>
                <div class="relative w-1/3 text-right">
                    <button onclick="toggleEditForm('email-form')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded-md text-sm flex items-center justify-end ml-auto" style="color: white !important;">
                        Edit <i class="fas fa-caret-down ml-2"></i>
                    </button>
                    <div id="email-form" class="hidden mt-2 bg-white dark:bg-gray-800 p-3 rounded-md shadow-lg absolute right-0 z-10 w-64">
                        <form method="post" action="{% url 'erp:update_profile' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="email">
                            <input type="email" name="email" placeholder="Email" class="w-full mb-2 p-2 text-gray-800 bg-gray-100 dark:bg-gray-700 dark:text-white rounded">
                            <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded w-full hover:bg-green-700">Save</button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center account-info-line border-b-0">
                <span class="font-medium w-1/3" style="color: white !important;">Password</span>
                <span class="text-lg w-1/3 text-left" style="color: white !important; opacity: 0.7;">Update your password</span>
                <div class="relative w-1/3 text-right">
                    <button onclick="toggleEditForm('password-form')" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-1 rounded-md text-sm flex items-center justify-end ml-auto" style="color: white !important;">
                        Update <i class="fas fa-caret-down ml-2"></i>
                    </button>
                    <div id="password-form" class="hidden mt-2 bg-white dark:bg-gray-800 p-3 rounded-md shadow-lg absolute right-0 z-10 w-64">
                        <form method="post" action="{% url 'erp:update_profile' %}">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="password">
                            <input type="password" name="current_password" placeholder="Current Password" class="w-full mb-2 p-2 bg-gray-100 dark:bg-gray-700 dark:text-white rounded">
                            <input type="password" name="new_password" placeholder="New Password" class="w-full mb-2 p-2 bg-gray-100 dark:bg-gray-700 dark:text-white rounded">
                            <input type="password" name="confirm_password" placeholder="Confirm Password" class="w-full mb-2 p-2 bg-gray-100 dark:bg-gray-700 dark:text-white rounded">
                            <button type="submit" class="bg-green-600 text-white px-3 py-1 rounded w-full hover:bg-green-700">Save</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-t border-gray-200 dark:border-gray-700 mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Account Protection</h2>

            <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-semibold text-lg mb-1 text-gray-900 dark:text-white">2-step Verification</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300">Enable 2-step verification to send security code to the email and phone number provided above whenever logging in.</p>
                </div>
                <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer" />
                    <label for="toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 dark:bg-gray-600 cursor-pointer"></label>
                </div>
            </div>
        </div>

        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-t border-gray-200 dark:border-gray-700 mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Application Settings</h2>
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-semibold text-lg mb-1 text-gray-900 dark:text-white">Dark Mode</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300">Toggle between light and dark mode for better viewing experience.</p>
                </div>
                <div class="flex items-center">
                    <input type="checkbox" id="darkModeToggle" class="toggle-checkbox" />
                </div>
            </div>
        </div>

        <!-- Logout Button -->
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md border-t border-gray-200 dark:border-gray-700">
            <div class="flex justify-between items-center">
                <div>
                    <h3 class="font-semibold text-lg mb-1 text-gray-900 dark:text-white">Logout</h3>
                    <p class="text-sm text-gray-700 dark:text-gray-300">Sign out from your current session</p>
                </div>
                <a href="{% url 'logout' %}" class="bg-red-600 text-white px-6 py-2 rounded-md hover:bg-red-700 transition-colors">
                    Logout <i class="fas fa-sign-out-alt ml-2"></i>
                </a>
            </div>
        </div>
    </div>

    <!-- Shipping Tab Content -->
    <div id="shipping-tab" class="tab-content hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Shipping Settings</h2>
            <p class="text-gray-700 dark:text-gray-300">Configure your default shipping preferences and address.</p>
            <!-- Shipping settings content here -->
        </div>
    </div>

    <!-- Notification Tab Content -->
    <div id="notification-tab" class="tab-content hidden">
        <div class="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-md mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-900 dark:text-white">Notification Settings</h2>
            <p class="text-gray-700 dark:text-gray-300">Configure which notifications you'd like to receive.</p>
            <!-- Notification settings content here -->
        </div>
    </div>
</div>

<style>
    .account-info-line {
        padding: 1rem 0;
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    }

    .dark .account-info-line {
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .tab-button.active {
        background-color: rgb(37, 99, 235); /* bg-blue-600 */
        color: white;
        border-radius: 0.5rem 0.5rem 0 0;
    }

    .dark .tab-button.active {
        background-color: rgb(29, 78, 216); /* bg-blue-700 */
        color: white;
    }

    .toggle-checkbox:checked {
        right: 0;
        border-color: #68D391;
    }

    .toggle-checkbox:checked + .toggle-label {
        background-color: #68D391;
    }
</style>

<script>
    // Dark mode toggle logic
    const darkModeToggle = document.getElementById('darkModeToggle');
    const body = document.body;

    // Check localStorage for dark mode preference and set toggle
    if (localStorage.getItem('darkMode') === 'enabled') {
        body.classList.add('dark');
        darkModeToggle.checked = true;
    }

    // Handle dark mode toggle
    darkModeToggle.addEventListener('change', function() {
        if (this.checked) {
            body.classList.add('dark');
            localStorage.setItem('darkMode', 'enabled');
        } else {
            body.classList.remove('dark');
            localStorage.setItem('darkMode', 'disabled');
        }
    });

    // Toggle form visibility
    function toggleEditForm(formId) {
        const form = document.getElementById(formId);
        const allForms = document.querySelectorAll('[id$="-form"]');

        // Hide all forms first
        allForms.forEach(f => {
            if (f.id !== formId) {
                f.classList.add('hidden');
            }
        });

        // Toggle the selected form
        form.classList.toggle('hidden');
    }

    // Tab switching functionality
    document.addEventListener('DOMContentLoaded', function() {
        const tabButtons = document.querySelectorAll('.tab-button');
        const tabContents = document.querySelectorAll('.tab-content');

        tabButtons.forEach(button => {
            button.addEventListener('click', function() {
                const tabName = this.getAttribute('data-tab');

                // Hide all tabs and remove active class
                tabContents.forEach(tab => tab.classList.add('hidden'));
                tabButtons.forEach(btn => btn.classList.remove('active'));

                // Show selected tab and add active class
                document.getElementById(tabName + '-tab').classList.remove('hidden');
                this.classList.add('active');
            });
        });
    });

    // 2-step verification toggle
    document.getElementById('toggle').addEventListener('change', function() {
        const isEnabled = this.checked;
        // You would typically send an AJAX request to update the user's preference
        console.log('2-step verification ' + (isEnabled ? 'enabled' : 'disabled'));
    });
</script>
{% endblock %}
